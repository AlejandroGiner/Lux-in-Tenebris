namespace = BtPLegacy_european_trade

##############################################
### Migration of Trade Power in the Low Countries, Written by Draiocht ###
##############################################

# Brugge to Antwerp
country_event = {
	id = BtPLegacy_european_trade.1
	title = "BtPLegacy_european_trade.EVTNAME1"
	desc = "BtPLegacy_european_trade.EVTDESC1"
	picture = CITY_VIEW_eventPicture

	fire_only_once = yes
	
	trigger = {
		is_year = 1490
		owns = 90			#Owns Brugge
		90 = { province_has_center_of_trade_of_level = 3 }
	}

	mean_time_to_happen = {
		months = 12
	}
	
	option = { # No, keep trade in Brugge
		name = "BtPLegacy_european_trade.EVTOPTA1"
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				owns = 1744			#Doesn't care if already owns Antwerp
			}
			modifier = {
				factor = 0
				NOT = { years_of_income = 7.5 }			#Wont do if would go too broke
			}
			modifier = {
				factor = 33
				years_of_income = 15.0			#More likely if plenty of money
			}
		}
		if = {
			limit = { NOT = { monthly_income = 25 } }				#Yearly income below 300 (meaning total cost under 3000)
			add_years_of_income = -10.0
		}
		if = {
			limit = { monthly_income = 25 }				#Caps out at 3000 cost for high income nations
			add_treasury = -3000
		}
		add_country_modifier = { name = "btpl_clearing_the_inlet" duration = 7300 }
	}
	option = { # Oh well, crap happens
		name = "BtPLegacy_european_trade.EVTOPTB1"
		ai_chance = {
			factor = 98
		}
		90 = {
			add_center_of_trade_level = -2
			add_base_tax = -5
			add_base_production = -5
			add_base_manpower = -3
		}
		1744 = { owner = { country_event = { id = BtPLegacy_european_trade.2 days = 1 } } }
		add_prestige = -10
	}
	option = { # Force the industry and port to move to Sluis, nearer to the sea
		name = "BtPLegacy_european_trade.EVTOPTC1"
		ai_chance = {
			factor = 1
		}
		90 = {
			rename_capital = "Sluis"
			add_center_of_trade_level = -1
			add_base_tax = -3
			add_base_production = -3
			add_base_manpower = -1
		}
	}
}

# Antwerp from Brugge
country_event = {
	id = BtPLegacy_european_trade.2
	title = "BtPLegacy_european_trade.EVTNAME2"
	desc = "BtPLegacy_european_trade.EVTDESC2"
	picture = CITY_VIEW_eventPicture

	major = yes
	is_triggered_only = yes
	
	option = { # Wonderful
		name = "BtPLegacy_european_trade.EVTOPTA2"
		1744 = {
			add_center_of_trade_level = 2
			add_base_tax = 5
			add_base_production = 6
			add_base_manpower = 3
		}
		add_prestige_or_monarch_power = { amount = 10 }
		if = {
			limit = {
				ROOT = {
					is_subject_of = CAS
					is_subject_of = SPA
					is_subject_of = POR
					is_subject_of = IBE
					is_subject_of = HAB
					tag = CAS
					tag = SPA
					tag = POR
					tag = IBE
					tag = HAB
				}
			}
			1744 = { change_trade_goods = sugar }	#Antwerp becomes the sugar capital of Europe, refining and shipping most of the sugar from Portugal and Spain.
		}
	}
}

# Antwerp to Amsterdam
country_event = {
	id = BtPLegacy_european_trade.3
	title = "BtPLegacy_european_trade.EVTNAME3"
	desc = "BtPLegacy_european_trade.EVTDESC3"
	picture = CITY_VIEW_eventPicture

	fire_only_once = yes
	
	trigger = {
		owns = 1744			#Owns Antwerp
		1744 = { province_has_center_of_trade_of_level = 3 }	#Antwerp has a Centre of Trade, ie. Brugge didn't keep it
		OR = {	#OR lines, any one of these will enable the event
			1744 = { controller = { is_in_deficit = yes } }	#Controller running in deficit
			1744 = { controller = { is_bankrupt = yes } }	#Controller is bankrupt
			1744 = { controlled_by = REB }	#Controller is a rebel faction
			1744 = { unrest = 30 }	#Very high unrest
			1744 = {	#Owner is subject and overlord has financial trouble   - This is what happened historically, look up Spanish Fury aka Sack of Antwerp
				owner = {
					is_subject_other_than_tributary_trigger = yes
					overlord = {
						OR = {
							is_in_deficit = yes
							is_bankrupt = yes
						}
					}
				}
			}
			AND = {	#AI controlled with no overlord
				ai = yes
				is_year = 1590
				is_free_or_tributary_trigger = yes
			}
			AND = {	#AI controlled with an overlord who is also ai controlled
				ai = yes
				is_year = 1590
				is_subject_other_than_tributary_trigger = yes
				overlord = { ai = yes }
			}
		}	#End of OR lines
		NOT = { is_year = 1620 }	#If the player can protect Antwerp until 1620, they deserve to keep it the CoT..... stays in vanilla anyway
	}

	mean_time_to_happen = {
		months = 30
		
		modifier = { #Slower for the AI
			factor = 2
			ai = yes
		}
		modifier = { #If it hasnt fired by 1619 and it should, make it near instant
			factor = 0.05
			is_year = 1619
		}
	}
	
	option = { # No, keep trade in Antwerp
		name = "BtPLegacy_european_trade.EVTOPTA3"
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				owns = 97			#Doesn't care if already owns Amsterdam
			}
			modifier = {
				factor = 0
				NOT = { years_of_income = 15.0 }			#Wont do if would go too broke
			}
			modifier = {
				factor = 33
				years_of_income = 30.0			#More likely if plenty of money
			}
		}
		if = {
			limit = { NOT = { monthly_income = 25 } }				#Yearly income below 300 (meaning total cost under 6000)
			add_years_of_income = -20.0
		}
		if = {
			limit = { monthly_income = 25 }				#Caps out at 6000 cost for high income nations
			add_treasury = -6000
		}
		add_country_modifier = { name = "btpl_stabilising_the_economy" duration = 7300 }
		if = {
			limit = { NOT = { has_dlc = "Common Sense" } }
			1744 = { add_province_modifier = { name = "severe_tax_reduction" duration = 3650 } }
		}
		if = {
			limit = { has_dlc = "Common Sense" }
			1744 = { add_province_modifier = { name = "btpl_investing_in_antwerp" duration = 7300 } }
		}
	}
	option = { # Oh well, crap happens
		name = "BtPLegacy_european_trade.EVTOPTB3"
		ai_chance = {
			factor = 99
		}
		1744 = {
			add_center_of_trade_level = -2
			add_base_tax = -5
			add_base_production = -6
			add_base_manpower = -3
			
		}
		97 = { owner = { country_event = { id = BtPLegacy_european_trade.4 days = 1 } } }
		add_prestige = -10
		if = {
			limit = {
				OR = {
					is_vassal = yes
					is_lesser_in_union = yes
				}
			}
			add_liberty_desire = 20
		}	#Conditional liberty desire only if owner is a vassal or lesser in union
	}
}

# Amsterdam from Antwerp
country_event = {
	id = BtPLegacy_european_trade.4
	title = "BtPLegacy_european_trade.EVTNAME4"
	desc = "BtPLegacy_european_trade.EVTDESC4"
	picture = CITY_VIEW_eventPicture

	major = yes
	is_triggered_only = yes
	
	option = { # Wonderful
		name = "BtPLegacy_european_trade.EVTOPTA4"
		97 = {
			add_center_of_trade_level = 2
			add_base_tax = 6
			add_base_production = 6
			add_base_manpower = 3
		}
		add_prestige_or_monarch_power = { amount = 10 }
	}
}

# Amsterdam boost - I lowered Amsterdams dev in 1444 because it was a nothing town, but I want to encourage its historical rise to power
country_event = {
	id = BtPLegacy_european_trade.5
	title = "BtPLegacy_european_trade.EVTNAME5"
	desc = "BtPLegacy_european_trade.EVTDESC5"
	picture = CITY_VIEW_eventPicture

	fire_only_once = yes
	
	trigger = {
		is_year = 1620
		owns = 97			#Owns Amsterdam
		primary_culture = dutch
		NOT = { is_year = 1681 }			#chance to just get plain unlucky, and miss out
	}

	mean_time_to_happen = {
		months = 120
		
		modifier = { #If it hasnt fired by this, make it more likely
			factor = 0.5
			is_year = 1640
		}
		modifier = { #If it hasnt fired by this, make it more likely
			factor = 0.5
			is_year = 1660
		}
		modifier = { #If it hasnt fired by this, make it more likely
			factor = 0.5
			is_year = 1680
		}
	}
	
	option = { # Wonderful
		name = "BtPLegacy_european_trade.EVTOPTA5"
		add_mercantilism = 15
		97 = {
			add_base_tax = 3
			add_base_production = 2
			add_base_manpower = 2
		}
		if = {
			limit = { 97 = { NOT = { province_has_center_of_trade_of_level = 3 } } }
			97 = {
				add_center_of_trade_level = 1
			}
		}	#If Player manages to keep CoT in Antwerp or Brugge until 1620 Amsterdam gets a new CoT and a larger boost
	}
}